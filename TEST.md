# 函数测试指南 (简化版)

## 重要更新

为了解决持续的JSON解析错误，我们已经将函数极大简化。现在函数使用**硬编码的用户ID**进行测试，而不是尝试从事件数据中解析。

## 使用步骤

### 1. 修改用户ID

首先，在部署函数前，您需要修改源代码中的用户ID。打开`src/index.js`文件，找到以下行：

```javascript
let userId = '683c11087ce0dae51608'; // 测试用的默认ID，请替换为实际需要清理的用户ID
```

将其中的ID替换为您想要清理资源的实际用户ID。

### 2. 设置环境变量

确保设置以下环境变量：

```
APPWRITE_ENDPOINT=https://your-appwrite-endpoint/v1
APPWRITE_API_KEY=your-api-key
APPWRITE_DATABASE_ID=your-database-id
APPWRITE_USERS_COLLECTION_ID=your-users-collection-id
APPWRITE_AVATAR_BUCKET_ID=your-avatar-bucket-id
```

### 3. 部署并测试函数

部署函数后，您可以直接运行它，不需要提供任何测试数据。函数会使用代码中硬编码的用户ID执行清理操作。

### 4. 查看日志

执行后，检查函数日志以了解执行情况。日志将显示：

- 使用的用户ID
- 环境变量是否正确设置
- 删除操作的结果

## 生产环境使用

对于生产环境，您有两个选择：

### 选项1：手动运行函数

每当需要清理用户资源时：
1. 更新函数代码中的用户ID
2. 重新部署函数
3. 执行函数

### 选项2：改进事件处理

如果您希望自动响应用户删除事件，您需要：

1. 分析Appwrite的用户删除事件的确切格式
2. 修改函数代码以正确解析该格式
3. 设置事件订阅

## 调试提示

如果函数仍然失败，请检查：

1. 日志中的环境变量是否正确显示
2. 存储桶ID和集合ID是否正确
3. API密钥是否具有足够的权限
4. 用户ID是否有效

## 简化原因

我们极大简化了函数代码，因为Appwrite的事件格式处理存在持续挑战。这个简化版本避免了所有复杂的JSON解析，直接使用硬编码的值进行操作，大大提高了成功率。